<% var speech = grunt.data.archieml.speech.speech; var annotations =
speech.filter(b => b.type == "annotation" && b.value.published); %>
<!DOCTYPE html>
<html lang="en-US">
  <head>
    <%= t.include("partials/_head.html", grunt.data.json) %>
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <main class="speech">
      <% speech.forEach(function(block, i) { var annoIndex =
      annotations.indexOf(block); var previous = annotations[annoIndex - 1]; var
      next = annotations[annoIndex + 1]; if (block.type == "text") {
      print(t.renderMarkdown(block.value)) } else if (block.value.published) {
      %>

      <observed-annotation
        id="<%= block.value.id %>"
        class="annotation"
        role="complementary"
      >
        <div class="content">
          <%= t.renderMarkdown(block.value.text) %>

          <div class="metadata">
            <% if (block.mug) { %>
            <div class="mugshot">
              <img src="<%= block.mug %>" />
            </div>
            <% } %>
            <div class="byline">
              <a
                target="<%= block.value.page %>"
                class="name"
                href="<%= block.value.page %>"
              >
                <%= block.value.author %>
              </a>
              <div class="role"><%= block.value.role %></div>
            </div>
          </div>
        </div>
        <div class="navigation">
          <% if (previous) { %>
          <a class="jump previous" href="#<%= previous.value.id %>">
            ▲ Previous annotation
          </a>
          <% } %> <% if (next) { %>
          <a class="jump next" href="#<%= next.value.id %>">
            Next annotation ▼
          </a>
          <% } %>
        </div>
      </observed-annotation>
      <% } }); %>
      <script src="app.js" async></script>
      <%= t.include("partials/_analytics.html") %>
    </main>
  </body>
</html>
