<!DOCTYPE html>
<html>
  <head>
    <?!= include("styles.html") ?>
  </head>
  <body>
    <form>
      <fieldset>
        <label for="author">Author</label>
        <select id="author">
          <option value="X">Select an author</option>
        <? data.authors.forEach(function(row) { ?>
          <option value="<?= row.key ?>"><?= row.name ?></option>
        <? }); ?>
          <option value="other">Other</option>
        </select>
        <input id="other" placeholder="Enter name for 'other'">
      </fieldset>
      <button class="add-post">Add draft</button>
    </form>
    <script>
var otherInput = document.querySelector("#other");
var authorSelect = document.querySelector("#author");
var onSelectAuthor = function() {
  if (authorSelect.value == "other") {
    otherInput.removeAttribute("hidden");
  } else {
    otherInput.setAttribute("hidden", "");
  }
};
authorSelect.addEventListener("change", onSelectAuthor);
onSelectAuthor();

var addButton = document.querySelector(".add-post");
addButton.addEventListener("click", function(e) {
  e.preventDefault();
  var inputs = document.querySelectorAll("select, input");
  var postData = {};
  for (var input of inputs) {
    postData[input.id] = input.type == "checkbox" ? input.checked * 1 : input.value;
  }
  if (postData.author == "X") return;
  google.script.run
    .withSuccessHandler(function() {
      google.script.host.close();
    })
    .addDraftAnnotation(postData);
});
    </script>
  </body>
</html>